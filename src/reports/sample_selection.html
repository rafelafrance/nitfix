<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8" />
<title>Sample plate report</title>

<style>
{% include 'sample_selection.css' -%}
</style>

</head>

<body>
  <h1>NitFix Sample Selections <span>{{ now.strftime('%Y-%m-%d %I:%M %p') }}</span></h1>

  <table>
    <thead>
      <tr class="header">
        <th></th>
        <th class="l">Family</th>
        <th class="l">Genus</th>
        <th class="r">Species<br/>Count</th>
        <th class="r">Sampled</th>
        <th class="r">Sequenced</th>
        <th class="r">Automatically<br/>Chosen</th>
        <th class="r">Available<br/>to Choose</th>
        <th class="r">Unprocessed<br/>Samples</th>
        <th class="r">Rejected<br/>Samples</th>
        <th class="r">Slots</th>
        <th class="r">Empty<br/>Slots</th>
      </tr>
    </thead>
    <tbody>
      {% for row in data %}
        {% if row.category in ['0_family', '1_genus', '9_total'] %}
          {% if row.category == '0_family' %}
            <tr class="family">
              <td><button class="toggle closed family-btn" data-family="{{ row.family }}" title="Open or close this family"></button></td>
              <td class="l">{{row.family}}</td>
              <td></td>
          {% elif row.category == '1_genus' %}
            <tr class="genus closed" data-family="{{ row.family }}">
              <td><button class="toggle closed" data-family="{{ row.family }}" data-genus="{{ row.genus }}" data-closed="closed" title="Open or close this genus"></button></td>
              <td></td>
              <td class="l">{{row.genus}}</td>
          {% elif row.category == '9_total' %}
            <tr class="total">
              <td></td>
              <td class="l">{{row.family}}</td>
              <td></td>
          {% endif %}
              <td class="r"><span>{{row.genus_count}}</span></td>
              <td class="r"><span>{{row.samples}}</span></td>
              <td class="r"><span>{{row['2_sequenced'] if row['2_sequenced'] else ''}}</span></td>
              <td class="r"><span>{{row['3_chosen'] if row['3_chosen'] else ''}}</span></td>
              <td class="r"><span>{{row['4_available'] if row['4_available'] else ''}}</span></td>
              <td class="r"><span>{{row['5_unprocessed'] if row['5_unprocessed'] else ''}}</span></td>
              <td class="r"><span>{{row['6_rejected'] if row['6_rejected'] else ''}}</span></td>
              <td class="r"><span>{{row.slots}}</span></td>
              <td class="r"><span>{{row['empty_slots'] if row['empty_slots'] else ''}}</span></td>
            </tr>

          {% if row.category == '1_genus' %}
            <tr class="sub-header detail closed" data-family="{{ row.family }}" data-genus="{{ row.genus }}" data-closed="closed">
              <td class="empty" colspan="3"></td>
              <td class="l" colspan="3">Scientific Name</td>
              <td class="r">Total DNA (ng)</td>
              <td>Plate</td>
              <td>Well</td>
              <td class="l" colspan="3">Sample ID</td>
            </tr>
          {% endif %}

        {% else %}
          <tr class="{{row.category[2:]}} detail closed" data-family="{{ row.family }}" data-genus="{{ row.genus }}" data-closed="closed">
            <td class="empty" colspan="2"></td>
            <td class="symbol r">
              {% if row.category == '2_sequenced' %}
                <span title="Already sequenced">&check;</span>
              {% elif row.category == '3_chosen' %}
                <span title="Automatically chosen">&oast;</span>
              {% elif row.category == '4_available' %}
                <span title="Available to choose">&oplus;</span>
              {% elif row.category == '5_unprocessed' %}
                <span title="Unprocessed sample">&odot;</span>
              {% elif row.category == '6_rejected' %}
                <span title="Rejected sample">&otimes;</span>
              {% endif %}
            </td>
            <td class="l" colspan="3">{{row.scientific_name}}</td>
            <td class="r"><span>{{'' if row.category == '5_unprocessed' else row.total_dna}}</span></td>
            <td>{{row.source_plate}}</td>
            <td>{{row.source_well}}</td>
            <td colspan="3">{{row.sample_id}}</td>
          </tr>

        {% endif %}
      {% endfor %}
    </tbody>
  </table>

<script>
{% include 'sample_selection.js' -%}
</script>

</body>
</html>
